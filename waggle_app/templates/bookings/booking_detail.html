{% extends 'base.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'waggle_app/css/bookings/booking_detail.css' %}">
{% endblock %}

{% block content %}
<section class="booking-detail">
  <h2>Booking Details</h2>

  <p><strong>Pets:</strong>
    {% for pet in booking.pets.all %}
      {{ pet.name }}{% if not forloop.last %}, {% endif %}
    {% empty %}
      No pets assigned.
    {% endfor %}
  </p>
  <p><strong>Owner:</strong> {{ booking.owner.user.username }}</p>
  <p><strong>Sitter:</strong> 
    {% if booking.sitter %}
      {{ booking.sitter.user.username }}
    {% else %}
      {{ booking.owner_and_sitter.name }}
    {% endif %}
  </p>
  <p><strong>Start Date:</strong> {{ booking.booking_start|date:"M d, Y" }}</p>
  <p><strong>End Date:</strong> {{ booking.booking_end|date:"M d, Y" }}</p>
  <p><strong>Status:</strong> {{ booking.status|title }}</p>
  {% if booking.message %}
    <p><strong>Notes:</strong> {{ booking.message }}</p>
  {% endif %}
  <a href="{% url 'booking_list' %}" class="btn">Back to Bookings</a>
</section>

<section class="messages">
  <h3>Messages</h3>
  {% for msg in booking.messages.all %}
    <div class="message {% if msg.sender == user %}sent{% else %}received{% endif %}">
      <p><strong>{{ msg.sender.username }}</strong>: {{ msg.content }}</p>
      <span class="timestamp">{{ msg.timestamp|date:"M d, H:i" }}</span>
    </div>
  {% empty %}
    <p>No messages yet.</p>
  {% endfor %}
<section class="send-message">
<h3>Send a Message</h3>
    <form method="post" action="{% url 'send_message' booking.pk %}">
        {% csrf_token %}
        {{ message_form.content }}
        <button type="submit" class="msgbtn">Send</button>
    </form>
</section>
</section>
{% endblock %}
